{{!
    This file is part of Moodle - http://moodle.org/

    Moodle is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    Moodle is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with Moodle.  If not, see <http://www.gnu.org/licenses/>.
}}
{{!
    @template mod_competvet/view/plannings


    Example context (json):
    {
        "categories": [
            {
                "categoryid": 1,
                "categorytext": "Category 1",
                "plannings": [
                    {
                        "startdate": "01/01/2019",
                        "enddate": "01/01/2019",
                        "groupname": "Group 1",
                        "nbstudents": 1,
                        "planningurl": "http://localhost/moodle/mod/competvet/view.php?id=1&planningid=1"
                    },
                    {
                        "startdate": "01/01/2019",
                        "enddate": "01/01/2019",
                        "groupname": "Group 2",
                        "nbstudents": 2,
                        "planningurl": "http://localhost/moodle/mod/competvet/view.php?id=1&planningid=2"
                    }
                ]
            },
            {
                "categoryid": 2,
                "categorytext": "Category 2",
                "plannings": [
                    {
                        "startdate": "01/01/2019",
                        "enddate": "01/01/2019",
                        "groupname": "Group 1",
                        "nbstudents": 1,
                        "planningurl": "http://localhost/moodle/mod/competvet/view.php?id=1&planningid=1"
                    },
                    {
                        "startdate": "01/01/2019",
                        "enddate": "01/01/2019",
                        "groupname": "Group 2",
                        "nbstudents": 2,
                        "planningurl": "http://localhost/moodle/mod/competvet/view.php?id=1&planningid=2"
                    }
                ]
            }
        ]
    }
}}
<link rel="stylesheet" href="{{wwwroot}}/mod/competvet/scss/styles.css?v={{version}}" />
<form class="form mb-5 simplesearchform">
    <div class="d-flex justify-content-between align-items-center">
        <div class="d-flex align-items-center">
            <input type="hidden" name="id" value="255">
            <div class="input-group">
                <label for="studentsearch-{{uniqid}}">
                    <span class="sr-only">{{#str}}search:student, mod_competvet{{/str}}</span>
                </label>
                <input type="text"
                       id="studentsearch-{{uniqid}}"
                       class="form-control"
                       placeholder="{{#str}}search:student, mod_competvet{{/str}}"
                       aria-label="{{#str}}search:student, mod_competvet{{/str}}"
                       name="studentsearch"
                       data-region="input"
                       autocomplete="off"
                       value="{{studentsearch}}"
                >
            </div>
            <div class="input-group ml-3">
                <label for="groupsearch-{{uniqid}}">
                    <span class="sr-only">{{#str}}search:group, mod_competvet{{/str}}</span>
                </label>
                <input type="text"
                       id="groupsearch-{{uniqid}}"
                       class="form-control"
                       placeholder="{{#str}}search:group, mod_competvet{{/str}}"
                       aria-label="{{#str}}search:group, mod_competvet{{/str}}"
                       name="groupsearch"
                       data-region="input"
                       autocomplete="off"
                       value="{{groupsearch}}"
                >
            </div>
        </div>
    </div>
</form>
<table class="competvet-grade-table w-100">
    <tr class="legend">
        <th class="label first"></th>
        <th class="label">{{#str}}stats, mod_competvet{{/str}}</th>
        <th class="label">{{#str}}grade, mod_competvet{{/str}}</th>
        <th class="label last">{{#str}}comments, mod_competvet{{/str}}</th>
    </tr>
    {{#categories}}
        {{#plannings}}
            <tr class="planning" data-planningid="{{id}}">
                <th class="planning-name" colspan="7">
                    <div class="position-relative d-flex align-items-center">
                        {{< mod_competvet/expandcollapse}}
                            {{$id}}{{id}}{{/id}}
                        {{/ mod_competvet/expandcollapse}}
                        <div class="d-flex w-100 align-items-center">
                            <div class="h3 mb-0 ml-2" data-region="groupname">{{groupname}}</div>
                            <div class="ml-1 mb-2"><span class="badge badge-info">{{categorytext}}<span></div>
                            <div class="ml-auto">{{startdate}} / {{enddate}}</div>
                        </div>
                    </div>
                </th>
            </tr>
            {{#students}}
                <tr class="student collapse {{^contentcollapsed}}show{{/contentcollapsed}}" data-planningid="{{planninginfo.planningid}}" id="collapse{{planninginfo.planningid}}">
                    <th class="user student-name">
                        <div class="d-flex align-items-center position-relative">
                            <img src="{{userinfo.userpictureurl}}" alt="{{userinfo.fullname}}" class="userpicture">
                            <a class="stretched-link" href="{{{profileurl}}}" data-region="studentname">{{userinfo.fullname}}</a>
                        </div>
                        <div class="d-flex justify-content-center">
                            <a class="btn btn-secondary btn-small text-center m-t-1" href="{{{gradeurl}}}" data-region="studentname">
                                {{#pix}}i/grades, core{{/pix}}
                                {{#str}}view, mod_competvet{{/str}}
                            </a>
                        </div>
                        </td>
                    <td class="t-grade stats">
                        <div class="position-relative">
                            {{#planninginfo}}
                                {{#stats.eval}}
                                    <span class="evalutations">
                                <span class="badge {{#pass}}badge-success{{/pass}}{{^pass}}badge-secondary{{/pass}} badge-pill" data-toggle="tooltip"
                                      title="{{#str}}planning:page:info:eval, mod_competvet{{/str}}">
                                    {{nbrequired}}/{{nbdone}}
                                    {{> mod_competvet/grading/svg/chat}}
                                </span>
                            </span>
                                {{/stats.eval}}
                                {{#stats.autoeval}}
                                    <span class="autoevaluations">
                                <span class="badge {{#pass}}badge-success{{/pass}}{{^pass}}badge-secondary{{/pass}} badge-pill" data-toggle="tooltip"
                                      title="{{#str}}planning:page:info:autoeval, mod_competvet{{/str}}">
                                    {{nbrequired}}/{{nbdone}}
                                    {{> mod_competvet/grading/svg/chat}}
                                </span>
                            </span>
                                {{/stats.autoeval}}
                                {{#stats.cert}}
                                    <span class="certications">
                                <span class="badge {{#pass}}badge-success{{/pass}}{{^pass}}badge-secondary{{/pass}} badge-pill" data-toggle="tooltip"
                                      title="{{#str}}planning:page:info:cert, mod_competvet{{/str}}">
                                    {{nbrequired}}/{{nbdone}}
                                    {{> mod_competvet/grading/svg/certif}}
                                </span>
                            </span>
                                {{/stats.cert}}
                                {{#stats.list}}
                                    <span class="cases">
                                <span class="badge {{#pass}}badge-success{{/pass}}{{^pass}}badge-secondary{{/pass}} badge-pill" data-toggle="tooltip"
                                      title="{{#str}}planning:page:info:list, mod_competvet{{/str}}">
                                    {{nbrequired}}/{{nbdone}}
                                    {{> mod_competvet/grading/svg/list}}
                                </span>
                            </span>
                                {{/stats.list}}
                            {{/planninginfo}}
                            <span class="badge badge-info icon-no-margin ml-4 badge-pill" data-toggle="tooltip" title="{{#str}}studentprogress, mod_competvet{{/str}}">
                            <a class="text-white stretched-link" href="{{{studenturl}}}">
                                {{#pix}}i/info, core{{/pix}}
                            </a>
                        </span>
                        </div>
                    </td>
                    <td class="t-grade globalgrade">{{#grade}}<span class="circle {{#failure}}fail{{/failure}}">{{grade}}</span>{{/grade}}</td>
                    <td class="t-grade comments">{{feedback}}</td>
                </tr>
            {{/students}}

        {{/plannings}}
    {{/categories}}
</table>
{{#js}}
    require(['{{modulename}}/local/view/plannings'], function(Plannings) {
    Plannings.init();
    });
{{/js}}