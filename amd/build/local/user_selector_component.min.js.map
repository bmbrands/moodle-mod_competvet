{"version":3,"file":"user_selector_component.min.js","sources":["../../src/local/user_selector_component.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * User selector component.\n *\n * @module     mod_competvet/local/user_selector_component\n * @copyright  2023 Laurent David <laurent@call-learning.fr>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {BaseComponent} from 'core/reactive';\nimport {getGradingAppReactive} from 'mod_competvet/local/grading_app_reactive';\nimport {default as Events} from 'mod_competvet/local/events';\n\nexport default class extends BaseComponent {\n    /**\n     * Constructor hook.\n     */\n    create() {\n        // Optional component name for debugging.\n        this.name = 'user-selector';\n        this.selectors = {\n            NEXT_USER: `[data-action='next-user']`,\n            PREVIOUS_USER: `[data-action='previous-user']`,\n            SHOW_HIDE_FILTERS: `[data-region='user-filters']`,\n            FILTER_REGION: `[data-region='configure-filters']`,\n            USER_LIST: `#change-user-select`,\n        };\n        this.cmId = this.getElement().dataset.cmid;\n    }\n\n    /**\n     * Static method to create a component instance form the mustache template.\n     *\n     * @param {Node} element the DOM main element\n     * @param {object} selectors optional css selector overrides\n     * @return {BaseComponent} the component instance\n     */\n    static init(element, selectors) {\n        const cmId = element.dataset.cmid;\n        const reactive = getGradingAppReactive(cmId); // Get or create reactive.\n        return new this({\n            element: element,\n            reactive: reactive,\n            selectors,\n        });\n    }\n\n    /**\n     * Initial state ready method.\n     *\n     * @return {Promise<void>}\n     */\n    async stateReady() {\n        // Get the element to replace.\n        const target = this.getElement();\n        this.addEventListener(\n            target.querySelector(this.selectors.NEXT_USER),\n            'click',\n            this._nextUser,\n        );\n        this.addEventListener(\n            target.querySelector(this.selectors.PREVIOUS_USER),\n            'click',\n            this._previousUser,\n        );\n        this.addEventListener(\n            target.querySelector(this.selectors.SHOW_HIDE_FILTERS),\n            'click',\n            this._filtersToggle,\n        );\n    }\n\n    /**\n     * Get Watcher\n     * @return {[{handler: *, watch: string}]}\n     */\n    getWatchers() {\n        return [\n            {watch: `state.currentUser:updated`, handler: this._updateUser},\n            {watch: `info.filterShow:updated`, handler: this._filterToggle},\n        ];\n    }\n\n    /**\n     * Filters toggle.\n     *\n     * @param {Event} event\n     */\n    _filtersToggle(event) {\n        event.preventDefault();\n        this.reactive.dispatch(Events.filtersToggle);\n    }\n\n    /**\n     * Next user.\n     *\n     * @param {Event} event\n     */\n    _nextUser(event) {\n        event.preventDefault();\n        this.reactive.dispatch(Events.currentUserChange, 'next');\n    }\n\n    /**\n     * Previous user.\n     *\n     * @param {Event} event\n     */\n    _previousUser(event) {\n        event.preventDefault();\n        this.reactive.dispatch(Events.currentUserChange, 'previous');\n    }\n\n    /**\n     * Updates the user interface to mark a user as selected based on the provided element's currentUser property.\n     *\n     * @param {Object} options\n     * @param {Object} options.element\n     * @private\n     */\n    _updateUser({element}) {\n        const userId = element.currentUser.id;\n        const selectElement = this.getElement().querySelector(this.selectors.USER_LIST);\n        const userElement = selectElement.querySelector(`option[value=\"${userId}\"]`);\n        if (userElement) {\n            userElement.selected = true;\n        }\n\n    }\n\n    /**\n     * Show or Hide the filter menu depending on user's action.\n     *\n     * @param {Object} options\n     * @param {Object} options.element\n     * @private\n     */\n    _filterToggle({element}) {\n        const filterRegion = this.element.querySelector(this.selectors.FILTER_REGION);\n        if (element.filterShow) {\n            filterRegion.classList.remove('d-none');\n        } else {\n            filterRegion.classList.add('d-none');\n        }\n    }\n}\n"],"names":["BaseComponent","create","name","selectors","NEXT_USER","PREVIOUS_USER","SHOW_HIDE_FILTERS","FILTER_REGION","USER_LIST","cmId","this","getElement","dataset","cmid","element","reactive","target","addEventListener","querySelector","_nextUser","_previousUser","_filtersToggle","getWatchers","watch","handler","_updateUser","_filterToggle","event","preventDefault","dispatch","Events","filtersToggle","currentUserChange","userId","currentUser","id","userElement","selected","filterRegion","filterShow","classList","remove","add"],"mappings":";;;;;;;oKA2B6BA,wBAIzBC,cAESC,KAAO,qBACPC,UAAY,CACbC,sCACAC,8CACAC,iDACAC,kDACAC,sCAECC,KAAOC,KAAKC,aAAaC,QAAQC,iBAU9BC,QAASX,iBACXM,KAAOK,QAAQF,QAAQC,YAEtB,IAAIH,KAAK,CACZI,QAASA,QACTC,UAHa,+CAAsBN,MAInCN,UAAAA,qCAWEa,OAASN,KAAKC,kBACfM,iBACDD,OAAOE,cAAcR,KAAKP,UAAUC,WACpC,QACAM,KAAKS,gBAEJF,iBACDD,OAAOE,cAAcR,KAAKP,UAAUE,eACpC,QACAK,KAAKU,oBAEJH,iBACDD,OAAOE,cAAcR,KAAKP,UAAUG,mBACpC,QACAI,KAAKW,gBAQbC,oBACW,CACH,CAACC,kCAAoCC,QAASd,KAAKe,aACnD,CAACF,gCAAkCC,QAASd,KAAKgB,gBASzDL,eAAeM,OACXA,MAAMC,sBACDb,SAASc,SAASC,gBAAOC,eAQlCZ,UAAUQ,OACNA,MAAMC,sBACDb,SAASc,SAASC,gBAAOE,kBAAmB,QAQrDZ,cAAcO,OACVA,MAAMC,sBACDb,SAASc,SAASC,gBAAOE,kBAAmB,YAUrDP,sBAAYX,QAACA,oBACHmB,OAASnB,QAAQoB,YAAYC,GAE7BC,YADgB1B,KAAKC,aAAaO,cAAcR,KAAKP,UAAUK,WACnCU,sCAA+Be,cAC7DG,cACAA,YAAYC,UAAW,GAY/BX,yBAAcZ,QAACA,qBACLwB,aAAe5B,KAAKI,QAAQI,cAAcR,KAAKP,UAAUI,eAC3DO,QAAQyB,WACRD,aAAaE,UAAUC,OAAO,UAE9BH,aAAaE,UAAUE,IAAI"}