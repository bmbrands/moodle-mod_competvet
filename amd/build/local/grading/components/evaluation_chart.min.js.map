{"version":3,"file":"evaluation_chart.min.js","sources":["../../../../src/local/grading/components/evaluation_chart.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Render the evaluation chart.\n *\n * @module     mod_competvet/local/grading/components/evaluation_chart\n * @copyright  2024 Bas Brands <bas@sonsbeekmedia.nl>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {get_string as getString} from 'core/str';\nimport CompetState from '../../competstate';\nimport Notification from 'core/notification';\nimport Templates from 'core/templates';\nimport ChartJS from 'core/chartjs';\n\nconst gradingApp = document.querySelector('[data-region=\"grading-app\"]');\n\n/*\n* Define the evaluation chart template.\n*/\nconst stateTemplate = () => {\n    const templateName = 'evaluation-chart';\n    const region = gradingApp.querySelector(`[data-region=\"${templateName}\"]`);\n    const template = `mod_competvet/grading/components/${templateName}`;\n    const regionRenderer = async(context) => {\n        if (context[templateName] === undefined) {\n            return;\n        }\n        Templates.render(template, context).then(async(html) => {\n            region.innerHTML = html;\n\n            // Render the Evaluation Chart.\n            const evalchart = document.getElementById('evaluation-chart');\n            const config = await chartConfig();\n            config.data = transformContext(context);\n            if (config.data.datasets.length > 0) {\n                new ChartJS(evalchart, config);\n            }\n\n            // Render the Auto Evaluation Chart.\n            const autoeval = document.getElementById('auto-evaluation-chart');\n            const autoevalConfig = await chartConfig(true);\n            autoevalConfig.data = transformContext(context, true);\n            if (autoevalConfig.data.datasets.length > 0) {\n                new ChartJS(autoeval, autoevalConfig);\n            }\n\n            if (config.data.datasets.length === 0 && autoevalConfig.data.datasets.length === 0) {\n                region.innerHTML = '';\n            }\n\n            return;\n        }).catch(Notification.exception);\n    };\n    CompetState.subscribe(templateName, regionRenderer);\n};\n\n/**\n * Transform the context to a format that can be used by the chart.\n * @param {Object} context The context object.\n * @param {Boolean} autoeval The autoeval flag.\n * @return {Object} The transformed context.\n */\nconst transformContext = (context, autoeval) => {\n    const currentUser = CompetState.getValue('user');\n    const self = currentUser.id;\n    const data = context['evaluation-results'];\n    const labels = data.evaluations.map(criterion => criterion.criterion.label);\n    const graders = [];\n    const colors = [\n        'rgba(255, 99, 132, 0.6)',\n        'rgba(54, 162, 235, 0.6)',\n        'rgba(255, 206, 86, 0.6)',\n        'rgba(75, 192, 192, 0.6)',\n        'rgba(153, 102, 255, 0.6)',\n        'rgba(255, 159, 64, 0.6)',\n    ];\n\n    data.evaluations.forEach(criterion => {\n        criterion.grades.forEach(grade => {\n            if (!grade.graderinfo || !grade.graderinfo.id) {\n                return;\n            }\n            if (autoeval && grade.graderinfo.id !== self) {\n                return;\n            } else if (!autoeval && grade.graderinfo.id === self) {\n                return;\n            }\n\n            if (!graders[grade.graderinfo.id]) {\n                const color = colors.shift();\n                graders[grade.graderinfo.id] = {\n                    label: grade.graderinfo.fullname,\n                    data: [],\n                    fill: false,\n                    backgroundColor: color,\n                    // add other properties as needed\n                };\n            }\n            graders[grade.graderinfo.id].data.push(grade.level);\n        });\n    });\n\n    return {\n        labels,\n        datasets: Object.values(graders)\n    };\n};\n\nconst chartConfig = async(autoeval) => {\n    let title = await getString('supervisorchart', 'mod_competvet');\n    if (autoeval) {\n        title = await getString('selfevaluation', 'mod_competvet');\n    }\n    return {\n        type: 'radar',\n        options: {\n            title: {\n                display: true,\n                text: title,\n                position: 'bottom',\n                fontSize: 16,\n            },\n            scale: {\n                ticks: {\n                    display: false,\n                }\n            },\n            plugins: {\n                title: {\n                    display: true,\n                    text: title,\n                    position: 'bottom',\n                },\n                legend: {\n                    display: true,\n                    position: 'bottom'\n                },\n            }\n        }\n    };\n};\n\nstateTemplate();"],"names":["gradingApp","document","querySelector","transformContext","context","autoeval","self","CompetState","getValue","id","data","labels","evaluations","map","criterion","label","graders","colors","forEach","grades","grade","graderinfo","color","shift","fullname","fill","backgroundColor","push","level","datasets","Object","values","chartConfig","async","title","type","options","display","text","position","fontSize","scale","ticks","plugins","legend","region","template","subscribe","undefined","render","then","innerHTML","html","evalchart","getElementById","config","length","ChartJS","autoevalConfig","catch","Notification","exception","stateTemplate"],"mappings":";;;;;;;yMA6BMA,WAAaC,SAASC,cAAc,+BAgDpCC,iBAAmB,CAACC,QAASC,kBAEzBC,KADcC,qBAAYC,SAAS,QAChBC,GACnBC,KAAON,QAAQ,sBACfO,OAASD,KAAKE,YAAYC,KAAIC,WAAaA,UAAUA,UAAUC,QAC/DC,QAAU,GACVC,OAAS,CACX,0BACA,0BACA,0BACA,0BACA,2BACA,kCAGJP,KAAKE,YAAYM,SAAQJ,YACrBA,UAAUK,OAAOD,SAAQE,WAChBA,MAAMC,YAAeD,MAAMC,WAAWZ,MAGvCJ,UAAYe,MAAMC,WAAWZ,KAAOH,QAE5BD,UAAYe,MAAMC,WAAWZ,KAAOH,MAAzC,KAIFU,QAAQI,MAAMC,WAAWZ,IAAK,OACzBa,MAAQL,OAAOM,QACrBP,QAAQI,MAAMC,WAAWZ,IAAM,CAC3BM,MAAOK,MAAMC,WAAWG,SACxBd,KAAM,GACNe,MAAM,EACNC,gBAAiBJ,OAIzBN,QAAQI,MAAMC,WAAWZ,IAAIC,KAAKiB,KAAKP,MAAMQ,cAI9C,CACHjB,OAAAA,OACAkB,SAAUC,OAAOC,OAAOf,WAI1BgB,YAAcC,MAAAA,eACZC,YAAc,mBAAU,kBAAmB,wBAC3C7B,WACA6B,YAAc,mBAAU,iBAAkB,kBAEvC,CACHC,KAAM,QACNC,QAAS,CACLF,MAAO,CACHG,SAAS,EACTC,KAAMJ,MACNK,SAAU,SACVC,SAAU,IAEdC,MAAO,CACHC,MAAO,CACHL,SAAS,IAGjBM,QAAS,CACLT,MAAO,CACHG,SAAS,EACTC,KAAMJ,MACNK,SAAU,UAEdK,OAAQ,CACJP,SAAS,EACTE,SAAU,cApHR,YAEZM,OAAS7C,WAAWE,sCADL,0BAEf4C,oDAFe,yCAiCTC,UAjCS,oBAGEd,MAAAA,eACWe,IAA1B5C,QAJa,wCAOP6C,OAAOH,SAAU1C,SAAS8C,MAAKjB,MAAAA,OACrCY,OAAOM,UAAYC,WAGbC,UAAYpD,SAASqD,eAAe,oBACpCC,aAAevB,cACrBuB,OAAO7C,KAAOP,iBAAiBC,SAC3BmD,OAAO7C,KAAKmB,SAAS2B,OAAS,OAC1BC,iBAAQJ,UAAWE,cAIrBlD,SAAWJ,SAASqD,eAAe,yBACnCI,qBAAuB1B,aAAY,GACzC0B,eAAehD,KAAOP,iBAAiBC,SAAS,GAC5CsD,eAAehD,KAAKmB,SAAS2B,OAAS,OAClCC,iBAAQpD,SAAUqD,gBAGU,IAAhCH,OAAO7C,KAAKmB,SAAS2B,QAAwD,IAAxCE,eAAehD,KAAKmB,SAAS2B,SAClEX,OAAOM,UAAY,OAIxBQ,MAAMC,sBAAaC,eA2F9BC"}