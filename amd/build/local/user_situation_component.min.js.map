{"version":3,"file":"user_situation_component.min.js","sources":["../../src/local/user_situation_component.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * User selector component.\n *\n * @module     mod_competvet/local/user_situation_component\n * @copyright  2023 Laurent David <laurent@call-learning.fr>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {BaseComponent} from 'core/reactive';\nimport {getGradingAppReactive} from 'mod_competvet/local/grading_app_reactive';\nimport {default as Events} from 'mod_competvet/local/events';\nimport Templates from 'core/templates';\n\nexport default class extends BaseComponent {\n    /**\n     * Constructor hook.\n     */\n    create() {\n        // Optional component name for debugging.\n        this.name = 'situation-selector';\n        this.selectors = {\n            NEXT_PLANNING: `[data-action='next-planning']`,\n            PREVIOUS_PLANNING: `[data-action='previous-planning']`,\n            USER_INFO_SELECTOR: `[data-region='user-info']`,\n            PLANNING_LIST: `#change-planning-select`,\n        };\n        this.cmId = this.getElement().dataset.cmid;\n    }\n    /**\n     * Static method to create a component instance form the mustache template.\n     *\n     * @param {Node} element the DOM main element\n     * @param {object} selectors optional css selector overrides\n     * @return {BaseComponent} the component instance\n     */\n    static init(element, selectors) {\n        const cmId = element.dataset.cmid;\n        const reactive = getGradingAppReactive(cmId); // Get or create reactive.\n        return new this({\n            element: element,\n            reactive: reactive,\n            selectors,\n        });\n    }\n\n    /**\n     * Initial state ready method.\n     *\n     * @return {Promise<void>}\n     */\n    async stateReady() {\n        // Get the element to replace.\n        const target = this.getElement();\n        this.addEventListener(\n            target.querySelector(this.selectors.NEXT_PLANNING),\n            'click',\n            this._nextPlanning,\n        );\n        this.addEventListener(\n            target.querySelector(this.selectors.PREVIOUS_PLANNING),\n            'click',\n            this._previousPlanning,\n        );\n    }\n\n    /**\n     * Get Watcher\n     * @return {[{handler: *, watch: string}]}\n     */\n    getWatchers() {\n        return [\n            {watch: `state.currentUser:updated`, handler: this._updateUser},\n            {watch: `state.currentUser:created`, handler: this._updateUser},\n            {watch: `state.plannings:updated`, handler: this._updatePlannings},\n        ];\n    }\n\n    /**\n     * Next situation.\n     *\n     * @param {Event} event\n     */\n    _nextPlanning(event) {\n        event.preventDefault();\n        this.reactive.dispatch(Events.planningChange, 'next');\n    }\n\n    /**\n     * Previous situation.\n     *\n     * @param {Event} event\n     */\n    _previousPlanning(event) {\n        event.preventDefault();\n        this.reactive.dispatch(Events.planningChange, 'previous');\n    }\n\n    /**\n     * Updates the situation list.\n     *\n     * @param {Object} options\n     * @param {Object} options.element\n     * @private\n     */\n    async _updateUser({element}) {\n        const currentUser = element.currentUser;\n        const {html, js} = await Templates.renderForPromise(\n            'mod_competvet/grading/navigation/user_info',\n            {...currentUser}\n        );\n        Templates.replaceNodeContents(this.getElement().querySelector(this.selectors.USER_INFO_SELECTOR), html, js);\n    }\n    /**\n     * Updates currently selected plannings.\n     *\n     * @param {Object} options\n     * @param {Object} options.element\n     * @private\n     */\n    _updatePlannings({element}) {\n        const selectElement = this.getElement().querySelector(this.selectors.PLANNING_LIST);\n        selectElement.innerHTML = '';\n        element.plannings.forEach(async (planning) => {\n            const option = document.createElement('option');\n            option.value = planning.id;\n            const {html} = await Templates.renderForPromise(\n                'mod_competvet/grading/navigation/planning_info',\n                {...planning}\n            );\n            option.innerHTML = html;\n            selectElement.appendChild(option);\n        });\n    }\n}\n"],"names":["BaseComponent","create","name","selectors","NEXT_PLANNING","PREVIOUS_PLANNING","USER_INFO_SELECTOR","PLANNING_LIST","cmId","this","getElement","dataset","cmid","element","reactive","target","addEventListener","querySelector","_nextPlanning","_previousPlanning","getWatchers","watch","handler","_updateUser","_updatePlannings","event","preventDefault","dispatch","Events","planningChange","currentUser","html","js","Templates","renderForPromise","replaceNodeContents","selectElement","innerHTML","plannings","forEach","async","option","document","createElement","value","planning","id","appendChild"],"mappings":";;;;;;;kMA4B6BA,wBAIzBC,cAESC,KAAO,0BACPC,UAAY,CACbC,8CACAC,sDACAC,+CACAC,8CAECC,KAAOC,KAAKC,aAAaC,QAAQC,iBAS9BC,QAASV,iBACXK,KAAOK,QAAQF,QAAQC,YAEtB,IAAIH,KAAK,CACZI,QAASA,QACTC,UAHa,+CAAsBN,MAInCL,UAAAA,qCAWEY,OAASN,KAAKC,kBACfM,iBACDD,OAAOE,cAAcR,KAAKN,UAAUC,eACpC,QACAK,KAAKS,oBAEJF,iBACDD,OAAOE,cAAcR,KAAKN,UAAUE,mBACpC,QACAI,KAAKU,mBAQbC,oBACW,CACH,CAACC,kCAAoCC,QAASb,KAAKc,aACnD,CAACF,kCAAoCC,QAASb,KAAKc,aACnD,CAACF,gCAAkCC,QAASb,KAAKe,mBASzDN,cAAcO,OACVA,MAAMC,sBACDZ,SAASa,SAASC,gBAAOC,eAAgB,QAQlDV,kBAAkBM,OACdA,MAAMC,sBACDZ,SAASa,SAASC,gBAAOC,eAAgB,wCAUhChB,QAACA,oBACTiB,YAAcjB,QAAQiB,aACtBC,KAACA,KAADC,GAAOA,UAAYC,mBAAUC,iBAC/B,6CACA,IAAIJ,iCAEEK,oBAAoB1B,KAAKC,aAAaO,cAAcR,KAAKN,UAAUG,oBAAqByB,KAAMC,IAS5GR,4BAAiBX,QAACA,qBACRuB,cAAgB3B,KAAKC,aAAaO,cAAcR,KAAKN,UAAUI,eACrE6B,cAAcC,UAAY,GAC1BxB,QAAQyB,UAAUC,SAAQC,MAAAA,iBAChBC,OAASC,SAASC,cAAc,UACtCF,OAAOG,MAAQC,SAASC,SAClBf,KAACA,YAAcE,mBAAUC,iBAC3B,iDACA,IAAIW,WAERJ,OAAOJ,UAAYN,KACnBK,cAAcW,YAAYN"}