define("mod_competvet/local/grading_app_component",["exports","core/reactive","mod_competvet/local/grading_app_reactive","mod_competvet/local/events"],(function(_exports,_reactive,_grading_app_reactive,_events){var obj;
/**
   * Grading app coponent
   *
   * This component is mostly used to ensure all subcomponents find a parent
   * compoment with a reactive instance defined.
   *
   * @module     mod_competvet/local/user_selector
   * @class     mod_competvet/local/userSelector
   * @copyright  2023 Laurent David <laurent@call-learning.fr>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_events=(obj=_events)&&obj.__esModule?obj:{default:obj};class _default extends _reactive.BaseComponent{create(){this.name="grading-app",this.selectors={USER_SELECTOR:"[data-region='user-selector']",SITUATION_INFO:"[data-region='user-situation-info']",LAYOUT_CONTROL:"[data-region='layout-control']",GRADER_FORMS:"[data-region='grader-item']"},this.userSelectorComponent=null,this.userSituationComponent=null,this.cmId=this.getElement().dataset.cmid}static init(element,selectors){const cmId=element.dataset.cmid;return new this({element:element,reactive:(0,_grading_app_reactive.getGradingAppReactive)(cmId),selectors:selectors})}async stateReady(){this.reactive.dispatch(_events.default.initUserList),this.layoutControl=await this.renderComponent(this.getElement(this.selectors.LAYOUT_CONTROL),"mod_competvet/grading/navigation/layout_control",{cmid:this.cmId})}getWatchers(){return[{watch:"state.users:created",handler:this._createUserSelector},{watch:"state.plannings:created",handler:this._createUserSituationInfo},{watch:"state.currentUser:updated",handler:this._updateUserSituationInfo}]}async _createUserSelector(_ref){let{element:element}=_ref;this.userSelectorComponent=await this.renderComponent(this.getElement(this.selectors.USER_SELECTOR),"mod_competvet/grading/navigation/user_selector",{cmid:this.cmId,users:element.users.toJSON()}),this.reactive.dispatch(_events.default.initUserSituationInfo)}async _createUserSituationInfo(_ref2){let{element:element}=_ref2;this.userSelectorComponent=await this.renderComponent(this.getElement(this.selectors.SITUATION_INFO),"mod_competvet/grading/navigation/situation_info",{cmid:this.cmId,user:element.currentUser})}async _updateUserSituationInfo(_ref3){let{element:element}=_ref3;const userId=element.currentUser.id,formelements=this.getElements(this.selectors.GRADER_FORMS);this.graderComponent=[];for(const el of formelements){const data=el.dataset;this.graderComponent[data.itemName]=await this.renderComponent(el.querySelector("[data-region='grader-container']"),"mod_competvet/grading/grader",{cmid:this.cmId,contextid:data.contextid,component:data.gradingComponent,subcomponent:data.gradingComponentSubtype,itemname:data.itemName,userid:userId})}}}return _exports.default=_default,_exports.default}));

//# sourceMappingURL=grading_app_component.min.js.map