{"version":3,"file":"eval_observation_delete.min.js","sources":["../../../src/local/forms/eval_observation_delete.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript adding a new observation.\n *\n * @module     mod_competvet/local/forms/observation_add_form\n * @copyright  2023 Laurent David <laurent@call-learning.fr>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {get_string as getString} from 'core/str';\nimport Notification from 'core/notification';\nimport ModalFactory from 'core/modal_factory';\nimport ModalEvents from 'core/modal_events';\nimport Ajax from 'core/ajax';\nimport {getSelectedElement} from './generic_form_helper';\n\nexport const init = (modulename) => {\n    const selectedElements = getSelectedElement('delete');\n    if (!selectedElements) {\n        return;\n    }\n    selectedElements.forEach((element) => {\n        element.addEventListener('click', (event) => {\n            event.preventDefault();\n            // Init an ok cancel modal.\n            getString('observation:delete', modulename).then((title) => {\n                ModalFactory.create({\n                    title: title,\n                    body: getString('observation:delete:confirm', modulename),\n                    type: ModalFactory.types.SAVE_CANCEL,\n                    large: true\n                }).then((modal) => {\n\n                    // Handle save event.\n                    modal.getRoot().on(ModalEvents.save, () => {\n                        // Query the APO delete_observation from mod_competvet_eval\n                        Ajax.call([{\n                            methodname: 'mod_competvet_eval_delete_observation',\n                            args: {\n                                observationid: event.target.dataset.id,\n                            },\n                            done: (data) => {\n                                if (data.success) {\n                                    // Close the modal.\n                                    modal.hide();\n                                    // Reload the page.\n                                    window.location.assign(event.target.dataset.returnurl);\n                                    window.location.reload();\n                                } else {\n                                    Notification.exception({message: data.error});\n                                }\n                            },\n                            fail: Notification.exception\n                        }]);\n                    });\n                    modal.show();\n\n                    return modal;\n                }).catch(Notification.exception);\n            });\n        });\n    });\n};\n"],"names":["modulename","selectedElements","forEach","element","addEventListener","event","preventDefault","then","title","create","body","type","ModalFactory","types","SAVE_CANCEL","large","modal","getRoot","on","ModalEvents","save","call","methodname","args","observationid","target","dataset","id","done","data","success","hide","window","location","assign","returnurl","reload","exception","message","error","fail","Notification","show","catch"],"mappings":";;;;;;;kSA8BqBA,mBACXC,kBAAmB,2CAAmB,UACvCA,kBAGLA,iBAAiBC,SAASC,UACtBA,QAAQC,iBAAiB,SAAUC,QAC/BA,MAAMC,qCAEI,qBAAsBN,YAAYO,MAAMC,+BACjCC,OAAO,CAChBD,MAAOA,MACPE,MAAM,mBAAU,6BAA8BV,YAC9CW,KAAMC,uBAAaC,MAAMC,YACzBC,OAAO,IACRR,MAAMS,QAGLA,MAAMC,UAAUC,GAAGC,sBAAYC,MAAM,mBAE5BC,KAAK,CAAC,CACPC,WAAY,wCACZC,KAAM,CACFC,cAAenB,MAAMoB,OAAOC,QAAQC,IAExCC,KAAOC,OACCA,KAAKC,SAELd,MAAMe,OAENC,OAAOC,SAASC,OAAO7B,MAAMoB,OAAOC,QAAQS,WAC5CH,OAAOC,SAASG,gCAEHC,UAAU,CAACC,QAAST,KAAKU,SAG9CC,KAAMC,sBAAaJ,gBAG3BrB,MAAM0B,OAEC1B,SACR2B,MAAMF,sBAAaJ"}