define("mod_competvet/local/forms/observation_forms",["exports","core_form/modalform","core/str","core/notification","core/modal_factory","core/modal_events","core/ajax"],(function(_exports,_modalform,_str,_notification,_modal_factory,_modal_events,_ajax){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Javascript adding a new observation.
   *
   * @module     mod_competvet/local/forms/observation_add_form
   * @copyright  2023 Laurent David <laurent@call-learning.fr>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.initForm=_exports.initEdit=_exports.initDelete=_exports.initAsk=_exports.initAdd=void 0,_modalform=_interopRequireDefault(_modalform),_notification=_interopRequireDefault(_notification),_modal_factory=_interopRequireDefault(_modal_factory),_modal_events=_interopRequireDefault(_modal_events),_ajax=_interopRequireDefault(_ajax);const initForm=async(action,modulename)=>{const selectedElements=document.querySelectorAll('[data-action="eval-observation-'.concat(action,'"]'));selectedElements.length&&selectedElements.forEach((element=>{element.addEventListener("click",(event=>{event.preventDefault();const datasetLowercase=Object.entries(event.target.dataset).reduce(((acc,_ref)=>{let[key,value]=_ref;return acc[key.toLowerCase()]=value,acc}),{}),modalForm=new _modalform.default({modalConfig:{title:(0,_str.get_string)("observation:".concat(action),modulename)},formClass:"".concat(modulename,"\\form\\eval_observation_").concat(action),args:{...datasetLowercase,currenturl:window.location.href},saveButtonText:(0,_str.get_string)("observation:".concat(action,":save"),modulename)});modalForm.addEventListener(modalForm.events.FORM_SUBMITTED,(event=>{event.detail.returnurl?(window.location.assign(event.detail.returnurl),window.location.reload()):_notification.default.addNotification({type:"error",message:event.detail.error})})),modalForm.show()}))}))};_exports.initForm=initForm;_exports.initAdd=modulename=>{initForm("add",modulename)};_exports.initEdit=modulename=>{initForm("edit",modulename)};_exports.initAsk=modulename=>{initForm("ask",modulename)};_exports.initDelete=modulename=>{const selectedElements=document.querySelectorAll('[data-action="eval-observation-delete"]');selectedElements.length&&selectedElements.forEach((element=>{element.addEventListener("click",(event=>{event.preventDefault(),(0,_str.get_string)("deleteobservation",modulename).then((title=>{_modal_factory.default.create({title:title,body:(0,_str.get_string)("deleteobservationconfirm",modulename),type:_modal_factory.default.types.SAVE_CANCEL,large:!0}).then((modal=>(modal.getRoot().on(_modal_events.default.save,(()=>{_ajax.default.call([{methodname:"mod_competvet_eval_delete_observation",args:{observationid:event.target.dataset.id},done:data=>{data.success?(modal.hide(),window.location.reload()):_notification.default.exception({message:data.error})},fail:_notification.default.exception}])})),modal.show(),modal))).catch(_notification.default.exception)}))}))}))}}));

//# sourceMappingURL=observation_forms.min.js.map