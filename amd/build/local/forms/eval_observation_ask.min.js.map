{"version":3,"file":"eval_observation_ask.min.js","sources":["../../../src/local/forms/eval_observation_ask.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Javascript adding a new observation.\n *\n * @module     mod_competvet/local/forms/observation_add_form\n * @copyright  2023 Laurent David <laurent@call-learning.fr>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport {get_string as getString} from 'core/str';\nimport Notification from 'core/notification';\nimport ModalFactory from 'core/modal_factory';\nimport Ajax from 'core/ajax';\nimport Template from \"core/templates\";\nimport {genericForm} from './generic_form_helper';\n\nexport const init = (modulename) => {\n    const handleAskSubmit = (event) => {\n        getString('observation:ask', modulename).then((title) => {\n            ModalFactory.create({\n                title: title,\n                body: Template.render('mod_competvet/view/eval_ask_observation_modal', {\n                    'planningid': event.detail.planningid,\n                    'studentid': event.detail.studentid,\n                    'observers': event.detail.observers,\n                    'context': event.detail.context,\n                    'modulename': modulename,\n                }),\n                type: ModalFactory.types.CANCEL,\n                large: true\n            }).then((modal) => {\n                modal.show();\n                return modal;\n            }).catch(Notification.exception);\n        });\n    };\n    genericForm('ask', modulename, handleAskSubmit);\n};\n\nexport const initUsersAction = (modulename, planningId, studentId, context) => {\n    const selectedElements = document.querySelectorAll('.ask-observation-modal [data-user-id]');\n    if (!selectedElements) {\n        return;\n    }\n    selectedElements.forEach((element) => {\n        element.addEventListener('click', (event) => {\n            event.preventDefault();\n            Ajax.call([{\n                methodname: 'mod_competvet_eval_ask_for_observation',\n                args: {\n                    context: context,\n                    planningid: planningId,\n                    observerid: element.dataset.userId,\n                    studentid: studentId,\n                },\n                done: (data) => {\n                    if (data.todoid) {\n                        element.classList.add('text-success');\n                    } else {\n                        getString('todo:cannotadd').then((message) => Notification.exception({message}));\n                    }\n                },\n                fail: Notification.exception\n            }]);\n        });\n    });\n};\n"],"names":["modulename","event","then","title","create","body","Template","render","detail","planningid","studentid","observers","context","type","ModalFactory","types","CANCEL","large","modal","show","catch","Notification","exception","planningId","studentId","selectedElements","document","querySelectorAll","forEach","element","addEventListener","preventDefault","call","methodname","args","observerid","dataset","userId","done","data","todoid","classList","add","message","fail"],"mappings":";;;;;;;qTA8BqBA,kDAoBL,MAAOA,YAnBMC,4BACX,kBAAmBD,YAAYE,MAAMC,+BAC9BC,OAAO,CAChBD,MAAOA,MACPE,KAAMC,mBAASC,OAAO,gDAAiD,YACrDN,MAAMO,OAAOC,qBACdR,MAAMO,OAAOE,oBACbT,MAAMO,OAAOG,kBACfV,MAAMO,OAAOI,mBACVZ,aAElBa,KAAMC,uBAAaC,MAAMC,OACzBC,OAAO,IACRf,MAAMgB,QACLA,MAAMC,OACCD,SACRE,MAAMC,sBAAaC,2CAMH,CAACtB,WAAYuB,WAAYC,UAAWZ,iBACzDa,iBAAmBC,SAASC,iBAAiB,yCAC9CF,kBAGLA,iBAAiBG,SAASC,UACtBA,QAAQC,iBAAiB,SAAU7B,QAC/BA,MAAM8B,+BACDC,KAAK,CAAC,CACPC,WAAY,yCACZC,KAAM,CACFtB,QAASA,QACTH,WAAYc,WACZY,WAAYN,QAAQO,QAAQC,OAC5B3B,UAAWc,WAEfc,KAAOC,OACCA,KAAKC,OACLX,QAAQY,UAAUC,IAAI,oCAEZ,kBAAkBxC,MAAMyC,SAAYtB,sBAAaC,UAAU,CAACqB,QAAAA,aAG9EC,KAAMvB,sBAAaC"}