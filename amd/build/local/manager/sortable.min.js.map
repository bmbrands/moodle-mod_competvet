{"version":3,"file":"sortable.min.js","sources":["../../../src/local/manager/sortable.js"],"sourcesContent":["// This file is part of Moodle - http://moodle.org/\n//\n// Moodle is free software: you can redistribute it and/or modify\n// it under the terms of the GNU General Public License as published by\n// the Free Software Foundation, either version 3 of the License, or\n// (at your option) any later version.\n//\n// Moodle is distributed in the hope that it will be useful,\n// but WITHOUT ANY WARRANTY; without even the implied warranty of\n// MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n// GNU General Public License for more details.\n//\n// You should have received a copy of the GNU General Public License\n// along with Moodle.  If not, see <http://www.gnu.org/licenses/>.\n\n/**\n * Create a jquery sortable list.\n *\n * @module     mod_competvet/local/manager/sortable\n * @copyright  2024 Bas Brands <bas@sonsbeekmedia.nl>\n * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later\n */\n\nimport $ from 'jquery';\nimport \"jqueryui\";\nimport CompetState from 'mod_competvet/local/competstate';\n\nconst reOrderState = (type, gridId, criteriumId, order) => {\n    let state = CompetState.getData();\n    if (type === 'criterium') {\n        state.grids.forEach((grid) => {\n            if (grid.gridid == gridId) {\n                order.forEach((criteriumId, index) => {\n                    grid.criteria.forEach((criterium) => {\n                        if (criterium.criteriumid == criteriumId) {\n                            criterium.sortorder = index;\n                        }\n                    });\n                    grid.criteria.sort((a, b) => {\n                        return a.sortorder - b.sortorder;\n                    });\n                });\n            }\n        });\n    }\n    if (type === 'option') {\n        state.grids.forEach((grid) => {\n            grid.criteria.forEach((criterium) => {\n                if (criterium.criteriumid == criteriumId) {\n                    order.forEach((optionId, index) => {\n                        criterium.options.forEach((option) => {\n                            if (option.optionid == optionId) {\n                                option.sortorder = index;\n                            }\n                        });\n                    });\n                    // Now sort the options.\n                    criterium.options.sort((a, b) => {\n                        return a.sortorder - b.sortorder;\n                    });\n                }\n            });\n        });\n    }\n    CompetState.setData(state);\n};\n\nconst sortable = (selector) => {\n    $(selector).sortable({\n        handle: '.drag-handle',\n        update: (event) => {\n            const type = $(event.target).data('type');\n            const gridId = $(event.target).data('gridId');\n            const criteriumId = $(event.target).data('criteriumId');\n            const order = $(event.target).sortable('toArray', {attribute: 'data-id'});\n            reOrderState(type, gridId, criteriumId, order);\n        },\n    });\n};\n\nexport default {\n    sortable: sortable,\n};"],"names":["sortable","selector","handle","update","event","type","gridId","criteriumId","order","state","CompetState","getData","grids","forEach","grid","gridid","index","criteria","criterium","criteriumid","sortorder","sort","a","b","optionId","options","option","optionid","setData","reOrderState","target","data","attribute"],"mappings":";;;;;;;4LAgFe,CACXA,SAdcC,+BACZA,UAAUD,SAAS,CACjBE,OAAQ,eACRC,OAASC,QA3CI,EAACC,KAAMC,OAAQC,YAAaC,aACzCC,MAAQC,qBAAYC,UACX,cAATN,MACAI,MAAMG,MAAMC,SAASC,OACbA,KAAKC,QAAUT,QACfE,MAAMK,SAAQ,CAACN,YAAaS,SACxBF,KAAKG,SAASJ,SAASK,YACfA,UAAUC,aAAeZ,cACzBW,UAAUE,UAAYJ,UAG9BF,KAAKG,SAASI,MAAK,CAACC,EAAGC,IACZD,EAAEF,UAAYG,EAAEH,kBAM9B,WAATf,MACAI,MAAMG,MAAMC,SAASC,OACjBA,KAAKG,SAASJ,SAASK,YACfA,UAAUC,aAAeZ,cACzBC,MAAMK,SAAQ,CAACW,SAAUR,SACrBE,UAAUO,QAAQZ,SAASa,SACnBA,OAAOC,UAAYH,WACnBE,OAAON,UAAYJ,aAK/BE,UAAUO,QAAQJ,MAAK,CAACC,EAAGC,IAChBD,EAAEF,UAAYG,EAAEH,wCAM/BQ,QAAQnB,QAWZoB,EAJa,mBAAEzB,MAAM0B,QAAQC,KAAK,SACnB,mBAAE3B,MAAM0B,QAAQC,KAAK,WAChB,mBAAE3B,MAAM0B,QAAQC,KAAK,gBAC3B,mBAAE3B,MAAM0B,QAAQ9B,SAAS,UAAW,CAACgC,UAAW"}