define("mod_competvet/local/manager/sortable",["exports","jquery","jqueryui","mod_competvet/local/competstate","mod_competvet/local/new-repository"],(function(_exports,_jquery,_jqueryui,_competstate,_newRepository){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}
/**
   * Create a jquery sortable list.
   *
   * @module     mod_competvet/local/manager/sortable
   * @copyright  2024 Bas Brands <bas@sonsbeekmedia.nl>
   * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
   */Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_jquery=_interopRequireDefault(_jquery),_competstate=_interopRequireDefault(_competstate),_newRepository=_interopRequireDefault(_newRepository);var _default={sortable:selector=>{(0,_jquery.default)(selector).sortable({handle:".drag-handle",update:event=>{(async(type,gridId,criteriumId,order)=>{let state=_competstate.default.getValue("datatree");"criterium"===type&&state.grids.forEach((grid=>{grid.gridid==gridId&&(grid.updatesortorder=!0,order.forEach(((criteriumId,index)=>{grid.criteria.forEach((criterium=>{criterium.criteriumid==criteriumId&&(criterium.sortorder=index)})),grid.criteria.sort(((a,b)=>a.sortorder-b.sortorder))})))})),"option"===type&&state.grids.forEach((grid=>{grid.criteria.forEach((criterium=>{criterium.criteriumid==criteriumId&&(criterium.updatesortorder=!0,order.forEach(((optionId,index)=>{criterium.options.forEach((option=>{option.optionid==optionId&&(option.sortorder=index)}))})),criterium.options.sort(((a,b)=>a.sortorder-b.sortorder)))}))})),_competstate.default.setValue("datatree",state);const saveState={grids:[...state.grids],type:_competstate.default.getValue("type")};await _newRepository.default.saveCriteria(saveState)})((0,_jquery.default)(event.target).data("type"),(0,_jquery.default)(event.target).data("gridId"),(0,_jquery.default)(event.target).data("criteriumId"),(0,_jquery.default)(event.target).sortable("toArray",{attribute:"data-id"}))}})}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=sortable.min.js.map