define("mod_competvet/local/grading2/grading_app_component",["exports","./repository","./competstate","./grading_app_autoregions","./grading_app_usernavigation","./grading_app_evaluations","./grading_app_comments"],(function(_exports,_repository,_competstate,_grading_app_autoregions,_grading_app_usernavigation,_grading_app_evaluations,_grading_app_comments){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(_exports,"__esModule",{value:!0}),_exports.default=void 0,_repository=_interopRequireDefault(_repository),_competstate=_interopRequireDefault(_competstate),_grading_app_usernavigation=_interopRequireDefault(_grading_app_usernavigation);class competvet{constructor(){_defineProperty(this,"gradingApp",void 0),_defineProperty(this,"competvet",void 0),_defineProperty(this,"currentUser",void 0),this.gradingApp=document.querySelector('[data-region="grading-app"]'),this.cmId=this.gradingApp.dataset.cmId,this.planningId=this.gradingApp.dataset.planningid,this.userlist=[],this.currentUser=0,this.render(),this.addEventListeners()}async render(){await this.getUsers(),this.renderUserNavigation(),await this.getEvaluations()}async getUsers(){const args={cmid:this.cmId,roletype:"student"},response=await _repository.default.getUserList(args);if(!response.users)return;this.userlist=response.users;const currentUserId=this.gradingApp.dataset.studentid;currentUserId&&"0"!==currentUserId?this.setCurrentUser(this.userlist.find((user=>user.id===parseInt(currentUserId)))):this.setCurrentUser(this.userlist[0])}renderUserNavigation(){const context={user:this.currentUser};let stateData=_competstate.default.getData();_grading_app_usernavigation.default.forEach((regionName=>{stateData[regionName]=context,_competstate.default.setData(stateData)}))}async getEvaluations(){const args={userid:this.currentUser.id,planningid:this.planningId},response=await _repository.default.getEvaluations(args);if(!response.evaluations)return;const context={eval:response.evaluations,comments:response.comments};let stateData=_competstate.default.getData();stateData.evaluations=context,_competstate.default.setData(stateData)}moveUser(direction){let index=this.userlist.indexOf(this.currentUser);"prev"===direction&&index>0?this.setCurrentUser(this.userlist[index-1]):"next"===direction&&index<this.userlist.length-1&&this.setCurrentUser(this.userlist[index+1]),this.renderUserNavigation(),this.getEvaluations()}setCurrentUser(user){this.currentUser=user}addEventListeners(){document.addEventListener("click",(event=>{event.target.closest('[data-action="prevuser"]')&&this.moveUser("prev"),event.target.closest('[data-action="nextuser"]')&&this.moveUser("next"),event.target.closest('[data-action="reload"]')&&this.getEvaluations()}))}}var _default={init:()=>{new competvet}};return _exports.default=_default,_exports.default}));

//# sourceMappingURL=grading_app_component.min.js.map